# コラージュアプリ仕様書

## 1. アプリ概要
本アプリは、ブラウザ上で画像やテキストを自由に配置し、コラージュ（スクラップブック）を作成・管理できるWebアプリケーションである。
**「セット（Set）」** という単位で複数のコラージュを管理し、IndexedDBを用いたローカル永続化と、Cloudflare Workersによるクラウド同期機能を備える。

## 2. コア機能要件

### 2.1 キャンバス & アイテム操作
ユーザーは「キャンバス」と呼ばれる領域にアイテム（画像/テキスト）を配置する。

*   **アイテム追加**:
    *   **画像**: ローカルファイル選択、ドラッグ＆ドロップ、クリップボードからの貼り付け（ペースト）に対応。
    *   **テキスト**: モーダル経由でテキストを入力し、色・サイズを指定して追加可能。
    *   **検索**: Google/DuckDuckGoへの外部リンクボタンによる画像検索補助。
*   **レイアウト操作**:
    *   **自由配置**: ドラッグ＆ドロップによるXY座標の変更。
    *   **自動整列（Packing）**: ボタン一つで隙間なく詰める自動レイアウト機能（masonry-like packing）。
    *   **スケーリング**: 選択中の画像に対して、スライダー操作で拡大・縮小（0.3倍〜3.0倍）が可能。
    *   **固定（Pin）**: 特定の画像を「ピン留め」し、自動整列時にも位置が動かないようにする機能。
*   **詳細操作（クロップ/ビューワーモード）**:
    *   画像をタップ/クリックすると詳細モーダルが開き、画像のトリミング（クロップ）が可能。
    *   **リンク機能**: 画像にURLを紐付け、クリック時に遷移させる機能。
    *   **ランダム表示**: 次の画像をランダムに表示する機能（長押しで連続再生）。

### 2.2 セット管理 (Collage Sets)
*   複数の「コラージュセット」を作成・切り替え可能。
*   **機能**: 新規作成、名前変更、削除、並び替え。
*   **マージ表示**: 複数のセットを選択し、一時的に一つのキャンバスとして統合表示する機能。
*   **プリセット**: 特定のセットの状態を「プリセット」として保存し、呼び出す機能。

### 2.3 データ管理 & 同期 (Sync)
大容量の画像データを扱うため、高度なデータ管理機能を実装する。

*   **ローカル保存 (IndexedDB)**:
    *   画像データ（Base64）を含む全データをブラウザのIndexedDB (`CollageAppDB`) に保存。
*   **クラウド同期 (Cloudflare Workers)**:
    *   **構成**: フロントエンドからCloudflare Workersのエンドポイントへデータを送信。
    *   **認証**: ユーザーID と キー（パスワード）による簡易認証。
    *   **分割アップロード**: 大容量データ（Base64画像群）を扱うため、データをMB単位のチャンク（Chunk）に分割してアップロード/ダウンロードするロジック。
    *   **ステータス表示**: クラウド上のデータ日時とローカル日時を比較し、「更新あり（黄色）」「未保存（グレー）」等のインジケータを表示。
*   **バックアップ**:
    *   **ZIP出力/読込**: 全画像のZIPダウンロード、独自形式でのバックアップZIPのインポート/エクスポート。

### 2.4 UI/UX 設定
*   **表示モード**: 全体をグレースケール化するモード。
*   **UI表示切替**: スクリーンショット用などに、各操作ボタン（カメラ、テキスト、検索など）の表示/非表示を個別に設定可能。
*   **テーマ**: 黒基調のダークモードに、アクセントカラー（ゴールド/イエロー）を使用したプレミアム感のあるデザイン。

## 3. データ構造 (参考)

### Item オブジェクト
```json
{
  "id": "uuid-string",
  "type": "image" | "text",
  "src": "base64-string",     // 画像の場合
  "text": "content-string",   // テキストの場合
  "x": 0,                     // X座標 (px)
  "y": 0,                     // Y座標 (px)
  "scale": 1.0,               // 拡大率
  "pinned": false,            // 固定フラグ
  "link": "https://...",      // 紐付けURL
  "color": "#ffffff",         // テキスト色
  "fontSize": 16              // フォントサイズ
}
```

## 4. 技術スタック要件 (現状)
*   **Frontend**: React (Vite), Pure CSS (No UI Framework like Bootstrap/MUI)
*   **Storage**: IndexedDB (idb wrapper recommended), LocalStorage (UI settings)
*   **Backend**: Cloudflare Workers + KV (Key-Value Storage)
*   **Libraries**:
    *   `jszip`: バックアップ用
    *   `crypto-js` (推定): パスワードハッシュ/暗号化用
